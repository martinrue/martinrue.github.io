<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Coding Stories: Me vs. The VNC Guy</title>
    <meta name="description" content="The story of how I finally got revenge on The VNC Guy back in my college days.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/assets/images/favicon/favicon-96x96.png" />
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="RSS Feed">

    <link rel="stylesheet" type="text/css" href="/assets/css/index.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/favicon/site.webmanifest">

    <meta property="og:url" content="https://martinrue.com/coding-stories-me-vs-vnc/">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Coding Stories: Me vs. The VNC Guy">
    <meta property="og:description" content="The story of how I finally got revenge on The VNC Guy back in my college days.">
    <meta property="og:image" content="https://martinrue.com/assets/images/og/articles.jpg" />

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@martinrue">
    <meta name="twitter:creator" content="@martinrue">

    <!-- START:ANALYTICS -->

    <script>
      !(function (t, e) {
        var o, n, p, r;
        e.__SV ||
          ((window.posthog = e),
          (e._i = []),
          (e.init = function (i, s, a) {
            function g(t, e) {
              var o = e.split(".");
              2 == o.length && ((t = t[o[0]]), (e = o[1])),
                (t[e] = function () {
                  t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
                });
            }
            ((p = t.createElement("script")).type = "text/javascript"),
              (p.async = !0),
              (p.src = s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") + "/static/array.js"),
              (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(p, r);
            var u = e;
            for (
              void 0 !== a ? (u = e[a] = []) : (a = "posthog"),
                u.people = u.people || [],
                u.toString = function (t) {
                  var e = "posthog";
                  return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e;
                },
                u.people.toString = function () {
                  return u.toString(1) + ".people (stub)";
                },
                o =
                  "capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(
                    " "
                  ),
                n = 0;
              n < o.length;
              n++
            )
              g(u, o[n]);
            e._i.push([i, s, a]);
          }),
          (e.__SV = 1));
      })(document, window.posthog || []);
      posthog.init("phc_Mz8MftazIe86xowQ53QSCpGJm2n7FzfsIVSePxiWeDS", {
        api_host: "https://us.i.posthog.com",
        person_profiles: "identified_only",
        autocapture: false,
        capture_pageleave: false,
      });
    </script>

    <!-- END:ANALYTICS -->
</head>

<body>
    <script src="/assets/js/lib.js"></script>
    <script src="/assets/js/dark-mode.js"></script>

    <div class="container">
        <header>
            <section class="bio">
                <a href="/">
                    <h1>Martin Rue</h1>
                </a>

                <h2>I build things on the internet.</h2>
            </section>

            <!-- START:LINKS -->

            <section class="links">
                <a href="https://youtube.com/@martinrue" aria-label="YouTube">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 23 22" stroke-width="0" stroke-linecap="round" stroke-linejoin="round">
                        <path class="yt" d="M7.84499 4.77535C10.4365 4.40822 13.5635 4.40822 16.155 4.77535C18.5096 5.10891 20.3341 6.76142 20.6831 8.54141C21.1056 10.6962 21.1056 13.3038 20.6831 15.4586C20.3341 17.2386 18.5096 18.8911 16.1551 19.2247C13.5635 19.5918 10.4365 19.5918 7.84499 19.2247C5.49049 18.8911 3.666 17.2386 3.31691 15.4586C2.89434 13.3038 2.89438 10.6962 3.31692 8.54142C3.66596 6.76141 5.49048 5.10891 7.84499 4.77535ZM16.4356 2.79512C13.658 2.40163 10.3421 2.40163 7.56446 2.79512C4.54986 3.22219 1.90016 5.37282 1.35429 8.15657C0.881927 10.5655 0.881875 13.4345 1.3543 15.8434C1.90021 18.6272 4.54984 20.7778 7.56446 21.2049C10.3421 21.5984 13.658 21.5984 16.4356 21.2049C19.4502 20.7778 22.0999 18.6272 22.6458 15.8434C23.1181 13.4345 23.1181 10.5655 22.6458 8.15658C22.0999 5.37281 19.4502 3.22219 16.4356 2.79512ZM10.5547 7.16795C10.2478 6.96338 9.8533 6.94431 9.52814 7.11833C9.20299 7.29234 9 7.6312 9 8V16C9 16.3688 9.20299 16.7077 9.52814 16.8817C9.8533 17.0557 10.2478 17.0366 10.5547 16.8321L16.5547 12.8321C16.8329 12.6466 17 12.3344 17 12C17 11.6656 16.8329 11.3534 16.5547 11.1679L10.5547 7.16795ZM14.1972 12L11 14.1315V9.86852L14.1972 12Z"></path>
                    </svg>
                </a>

                <a href="https://instagram.com/martinrue" aria-label="Instagram">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                    </svg>
                </a>

                <a href="https://twitter.com/martinrue" aria-label="Twitter">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
                        </path>
                    </svg>
                </a>

                <a href="https://mstdn.social/@martinrue" rel="me" aria-label="Mastodon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22" stroke-width="0" stroke-linecap="round" stroke-linejoin="round">
                        <path class="masto" d="M3.018,12.008 C2.986,10.748 3.006,9.56 3.006,8.566 C3.006,4.228 5.849,2.956 5.849,2.956 C7.282,2.298 9.741,2.021 12.299,2 L12.361,2 C14.918,2.02 17.379,2.298 18.812,2.956 C18.812,2.956 21.655,4.228 21.655,8.566 C21.655,8.566 21.691,11.767 21.259,13.99 C20.984,15.4 18.802,16.945 16.296,17.244 C14.99,17.4 13.703,17.544 12.331,17.48 C10.088,17.377 8.317,16.945 8.317,16.945 C8.317,17.163 8.331,17.371 8.357,17.565 C8.441,18.198 8.656,18.66 8.962,19 C9.728,19.85 11.068,19.93 12.357,19.974 C14.177,20.037 15.797,19.525 15.797,19.525 L15.873,21.171 C15.873,21.171 14.599,21.855 12.331,21.981 C11.081,22.049 9.528,21.949 7.719,21.471 C6.187,21.065 5.151,20.181 4.449,19 C3.356,17.157 3.081,14.594 3.018,12.008 Z M6.318,16.945 L6.318,14.397 L8.792,15.002 C9.22358374,15.0976669 9.6581434,15.1793761 10.095,15.247 C10.848,15.363 11.633,15.447 12.423,15.482 C13.442,15.529 14.324,15.465 16.059,15.258 C17.722,15.059 19.207,14.062 19.295,13.608 C19.377,13.186 19.446,12.686 19.501,12.126 C19.5717075,11.3794052 19.6173998,10.6306525 19.638,9.881 C19.653,9.371 19.658,8.936 19.655,8.625 L19.655,8.566 C19.655,7.136 19.286,6.128 18.692,5.408 C18.5226287,5.20011999 18.3262218,5.01582031 18.108,4.86 C18.018,4.796 17.973,4.771 17.978,4.773 C16.965,4.308 14.885,4.021 12.361,4 L12.315,4 C9.775,4.02 7.695,4.308 6.665,4.782 C6.688,4.772 6.644,4.796 6.553,4.86 C6.33477821,5.01582031 6.13837125,5.20011999 5.969,5.408 C5.375,6.128 5.006,7.137 5.006,8.566 C5.006,8.798 5.006,8.963 5.003,9.441 C4.99402715,10.2803538 4.99869443,11.1197979 5.017,11.959 C5.071,14.156 5.281,15.794 5.717,17 C5.929,17.587 6.189,18.07 6.497,18.45 C6.37026932,17.9585833 6.30973424,17.4524428 6.317,16.945 L6.318,16.945 Z M8.084,6.37 C8.71553761,6.37 9.2275,6.88196239 9.2275,7.5135 C9.2275,8.14503761 8.71553761,8.657 8.084,8.657 C7.45246239,8.657 6.9405,8.14503761 6.9405,7.5135 C6.9405,6.88196239 7.45246239,6.37 8.084,6.37 Z"></path>
                    </svg>
                </a>

                <a href="https://github.com/martinrue" aria-label="GitHub">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                        </path>
                    </svg>
                </a>
                
                <a href="#" class="dark-mode" aria-label="Dark mode">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </a>
            </section>

            <!-- END:LINKS -->
        </header>

        <nav>
            <a href="/articles/">Articles</a>
            <a href="/projects/">Projects</a>
            <a href="/books/">Books</a>
            <a href="/now/">Now</a>
        </nav>

        <article>
            <h3>Coding Stories: Me vs. The VNC Guy</h3>

            <p>
                I've told a few different coding stories over the years on this blog. I enjoy reminiscing about the
                silly things I used to do. So, in that vein, here's one I haven't told yet.
            </p>

            <p>
                I first became interested in computers, programming especially, when I was about 11. During the early
                years of high school I spent most of my free time screwing around with my C64 and writing BASIC,
                eventually cutting out some bad code I wrote with scissors. No,
                <a href="/give-yourself-more-playtime/">really</a>.
            </p>

            <p>
                Right after high school (aged ~16) kids in the UK usually go to college, where they choose 3 to 4
                subjects to study before eventually moving on to university. Given I was so in love with my beige box
                and tape deck at home, I figured studying “computing” at college was the way to go.
            </p>

            <p>
                I enjoyed the course more than I expected, which exposed me to Pascal and Delphi for the first time.
            </p>

            <p>
                Between classes students could use any free machine in the computer hall. Picture the scene: a huge
                room, probably space for 100 people, with rows and rows of desks lined with machines – the kind where
                the monitor sat on top of the computer. There was a constant dull humming noise, and a dedicated mouse
                ball thief in constant operation. The air had a strange smell, almost as though the scent of 50-100
                hormonal teenagers was being used cyclically to cool 100 P3 chips.
            </p>

            <p>
                Despite the health risks, it was cool that I could wander into the computer hall and grab a machine
                whenever I had free time.
            </p>

            <p>
                Policing the room was the IT technician, a small middle-aged man who had been selected for the role due
                to his aspirations of one day becoming an evil dictator. I assume. Policing is probably too weak a word
                – this guy loved his job. He was tasked with keeping order in the room, ensuring that nobody was using a
                college computer for anything untoward.
            </p>

            <p>
                To this day, my intuition tells me that his bonus must have been dependent on how many people he managed
                to kick off a machine and escort out of the room, and that it's doubtful he didn't pay off his mortgage
                early.
            </p>

            <p>
                He sat in the far corner of the computer hall behind a corner desk, where one could fairly conclude that
                his fertile monitors had found a way to reproduce with an impressively short gestation period. It was
                anyone's guess whether he was actually behind them. Of course, I'm kidding… did I mention that he took
                his job very seriously?
            </p>

            <p>
                The network of machines ran Windows 2000 at the time. I soon discovered that every login process ran a
                script that started a VNC server process using a privileged account. Whenever the IT technician made you
                his next target, he'd connect directly to your machine and watch you. It was creepy, and thinking about
                it now, most likely illegal.
            </p>

            <p>
                Having cut my teeth with <a href="/give-yourself-more-playtime/">BASIC on the C64</a>, I was now writing
                C and even a bit of C++. At the time, I was also really into D, believing it to be a nice overhaul of
                some of the things I didn't like about C++.
            </p>

            <p>
                Most of my visits to the computer hall were to read more about D, or play with the Digital Mars D
                compiler. When I wasn't convincing myself that D was the future, I would write C code to hack other
                Win32 programs via their window handles.
            </p>

            <p>
                Back in the good old days of Win32 programming, finding a window handle was the easy method to start
                hacking other programs. Unsurprisingly, all visual programs in Windows had a window, even if you
                couldn't see it. By writing a program that acquired the window handle (essentially a reference) of
                another process, you could send it messages. That allowed you to do basic things like hide/show the
                program's window(s), or do really cool things like cause the process to load a custom DLL into its
                memory space and begin executing code. You could really start to have some fun once you got into DLL
                injection territory.
            </p>

            <p>
                During the first 6 weeks of college, Detective Technician didn't bother me much, connecting briefly to
                my machine's VNC server only once or twice. However, one particular session must have piqued his
                interest. I was writing some C code to hide instances of Minesweeper (without closing them) so I could
                play it more easily in class, when I noticed the white VNC icon in my system tray turn black, meaning he
                was now watching me.
            </p>

            <p>
                I continued coding as normal, trying to ignore him. Meanwhile, my machine was now grinding to a halt as
                it attempted to stream the very best frame rate it could over to one of the ridiculous number of
                monitors in the corner of the room. It wasn't long before it had become only slightly more resposive
                than a brick, so I logged off and called it a day.
            </p>

            <p>
                Over the next few visits to the computer hall, Columbo took a very keen interest in what I was doing
                almost every time. After about the 4th time, I decided I needed to do something about it.
            </p>

            <p>
                A sensible, rational person may have simply raised the issue with him or his boss directly, I admit
                that. I, however, have always been tempted by the challenge, and quickly talked myself into an
                altogether different strategy to solve the problem.
            </p>

            <p>
                “You're nothing without that VNC server!” I told myself <strike>calmly</strike> emphatically
                <strike>once</strike> more than once.
            </p>

            <p>
                I needed to kill VNC.
            </p>

            <p>
                I started entering the computer hall with larger groups of people and sitting as far away from monitor
                corner as possible. That worked for a while, and bought me some time to explore ideas.
            </p>

            <p>
                My first attempt, I think you'll agree, was rather weak. Right-clicking the VNC system tray icon, I was
                met with a menu containing those magic letters E-x-i-t. Unfortunately they were written in grey outlined
                text. They had used the Group Policy Editor to disable the "Exit" menu item, which I had seen done
                before. I also tried to kill the process from Task Manager, but of course it was invisible to me as it
                was running under another, more privileged account. No dice.
            </p>

            <p>
                VNC server runs on TCP port 5900, I remembered. My next plan was to send it intentionally malformed
                packets to make it crash.
            </p>

            <p>
                That kept me busy for at least a few days while I tried to work out the protocol and sent it various
                forms of legitimately structured crap, hoping it would implode. In the end, that also didn't work. No
                dice again.
            </p>

            <p>
                I was coming to the conclusion that I may not be able to get rid of this thing when it hit me.
            </p>

            <p>
                “It must have a window! Maybe if I show it, it'll have a nice juicy "Shut Down" button I can make very
                good use of.”
            </p>

            <p>
                Yielding my already perfected C code to locate a another process's main window handle, I indeed managed
                to find VNC's. It really felt like I was about to strike oil when I dispatched a
                <code>WM_SHOWWINDOW</code> message. Before I tell you, try to guess what appeared before me?
            </p>

            <p>
                Nothing!
            </p>

            <p>
                Now I was curious… it had a window alright, but it was ignoring the messages I was sending. I
                double-checked my code to make sure it worked. I tested it on a few other processes and it worked just
                fine. I tried sending VNC's window other kinds of messages, and still nothing.
            </p>

            <p>
                And that's when it dawned on me!
            </p>

            <p>
                Thanks to Charles Petzold's very heavy <a href="http://amzn.com/157231995X">book</a>, I'd become an avid
                student of how Win32 processes worked internally. Every Win32 application has a window, and as part of
                that it also has a "message queue". Messages caused by user interactions, and those sent by Windows
                itself are received on the message queue, and it's the responsibility of the application itself to deal
                with those messages.
            </p>

            <p>
                Not too interesting by itself, but when I realised that a large enough unprocessed message queue is a
                heuristic for a hung process intervention by the Window Process Manager, I was sweating pure serotonin.
            </p>

            <p>
                Without a second to spare, I was back in front of my C code getting it ready to send VNC's main window
                another <code>WM_SHOWWINDOW</code> message. In a loop. Forever. So, lots and lots of
                <code>WM_SHOWWINDOW</code> messages, which I now knew it intended to completely ignore… to its peril.
            </p>

            <p>
                I compiled and ran 4KB of some of most liberating code I'd ever written. About 3 seconds later Windows
                informed me that <code>vncserver.exe</code> was not responding, making me an offer I just can't refuse.
            </p>

            <p>
            <blockquote>Do you want to end this process?</blockquote>
            </p>

            <p>
                Fuck yes!
            </p>

            <p>
                Let me tell you, the rest of that afternoon I was unbearably pleased with myself.
            </p>

            <p>
                After a few hours spent digesting my new superpower, I had decided how I was going to use it. Simply
                killing his session in front of his very eyes would be too easy. I had a better idea – I'd disappear
                altogether.
            </p>

            <p>
                After my <a href="/zzuy-a-lesson-in-perseverance/">baptism of fire with socket programming</a>, I
                realised I could write some code that would do two things. First it would bind to the newly freed up TCP
                port 5900, previously occupied by an ignorant VNC server process. Second it would make a new TCP
                connection to a designated machine's VNC server. If the code simply proxied all data between the two
                sockets, Columbo would think he was connecting to me, when he'd actually be connecting to someone else
                entirely.
            </p>

            <p>
                My code would act as a secret bridge between me and some other poor soul of my choosing. It was perfect.
            </p>

            <p>
                I got started right away writing my fake VNC bridge. Columbo connected to me a few times, but I
                continued coding as he watched. I figured he'd have no idea what I was doing as long as I left out
                obvious things like port numbers, and comments I otherwise might have included, such as
                <code>// Goodbye creepy VNC spy guy</code>.
            </p>

            <p>
                After a couple of days, I was really struggling to get the code to work correctly. Making matters worse,
                I wasn't getting much time without a black VNC icon in my system tray. While he was connected to me, it
                was impossible to free up the port to test my code.
            </p>

            <p>
                If only I'd known about <code>netcat</code> at this point!
            </p>

            <p>
                In the end, being an impatient 17-year old and seeing another white VNC server icon turn black, I'm
                sorry to say that I threw the plan out of the window. I opened up the code I first wrote to flood VNC's
                message queue and I ran it while he watched. I even waited a couple of seconds before clicking "End
                Process", just to make sure he saw it.
            </p>

            <p>
                If clicking that button didn't fully convince me it was worth it, seeing him emerge from behind his
                monitor fortress to fast-walk his way over to me and escort me out of the room definitely did.
            </p>

            <p>
                In the end, they banned me from the network for 2 weeks. A fair punishment, I thought. About 3 weeks
                later, VNC server was no longer being run during login scripts and was nowhere to be found. I never
                found out whether my incident played any part in that or not, but it totally ruined my plan to become
                filthy rich by selling my VNC cannon to oppressed college computer halls across the country.
            </p>

            <p>
                If you enjoyed this, you may also enjoy some of my other coding stories:
            </p>

            <ul>
                <li>
                    <a href="/zzuy-a-lesson-in-perseverance/">ZZüy – A Lesson In Perseverance</a>
                </li>

                <li>
                    <a href="/give-yourself-more-playtime/">Give Yourself More Playtime</a>
                </li>
            </ul>
        </article>
    </div>
</body>

</html>
