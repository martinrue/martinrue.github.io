<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Coding Stories: Me vs. The VNC Guy</title>
    <meta name="description" content="The story of how I finally got revenge on The VNC Guy back in my college days.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preload" href="/assets/fonts/montserrat-light.otf" as="font" crossorigin>
    <link rel="preload" href="/assets/fonts/montserrat-regular.otf" as="font" crossorigin>
    <link rel="preload" href="/assets/fonts/montserrat-medium.otf" as="font" crossorigin>
    <link rel="preload" href="/assets/fonts/montserrat-semibold.otf" as="font" crossorigin>

    <link rel="stylesheet" type="text/css" href="/assets/css/index.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/favicon/site.webmanifest">

    <meta property="og:url" content="https://martinrue.com">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Coding Stories: Me vs. The VNC Guy">
    <meta property="og:description" content="The story of how I finally got revenge on The VNC Guy back in my college days.">
    <meta property="og:image" content="https://martinrue.com/assets/images/favicon/martin.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@martinrue">
    <meta name="twitter:creator" content="@martinrue">
</head>

<body>
    <script src="/assets/js/lib.js"></script>
    <script src="/assets/js/dark-mode.js"></script>

    <div class="container">
        <header>
            <section class="bio">
                <a href="/">
                    <h1>Martin Rue</h1>
                </a>

                <h2>Making things. Writing code. Languages.</h2>
            </section>

            <section class="links">
                <a href="https://twitter.com/martinrue" aria-label="Twitter">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
                        </path>
                    </svg>
                </a>

                <a href="https://instagram.com/martinrue" aria-label="Instagram">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                    </svg>
                </a>

                <a href="https://github.com/martinrue" aria-label="GitHub">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                        </path>
                    </svg>
                </a>

                <a href="mailto:hello@martinrue.com" aria-label="Email">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                </a>

                <a href="#" class="dark-mode" aria-label="Dark mode">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </a>
            </section>
        </header>

        <nav>
            <a href="/articles/">Articles</a>
            <a href="/projects/">Projects</a>
            <a href="/books/">Books</a>
            <a href="/now/">Now</a>
        </nav>

        <article>
            <h3>Coding Stories: Me vs. The VNC Guy</h3>

            <p>
                I’ve told a few different coding stories over the years on this blog. I enjoy reminiscing about the
                silly things I used to do. So, in that vein, here’s one I haven’t told yet.
            </p>

            <p>
                I first became interested in computers, programming especially, when I was about 11. During the early
                years of high school I spent most of my free time screwing around with my C64 and writing BASIC,
                eventually cutting out some bad code I wrote with scissors. No,
                <a href="/give-yourself-more-playtime/">really</a>.
            </p>

            <p>
                Right after high school (aged ~16) kids in the UK usually go to college, where they choose 3 to 4
                subjects to study before eventually moving on to university. Given I was so in love with my beige box
                and tape deck at home, I figured studying “computing” at college was the way to go.
            </p>

            <p>
                I enjoyed the course more than I expected, which exposed me to Pascal and Delphi for the first time.
            </p>

            <p>
                Between classes students could use any free machine in the computer hall. Picture the scene: a huge
                room, probably space for 100 people, with rows and rows of desks lined with machines – the kind where
                the monitor sat on top of the computer. There was a constant dull humming noise, and a dedicated mouse
                ball thief in constant operation. The air had a strange smell, almost as though the scent of 50-100
                hormonal teenagers was being used cyclically to cool 100 P3 chips.
            </p>

            <p>
                Despite the health risks, it was cool that I could wander into the computer hall and grab a machine
                whenever I had free time.
            </p>

            <p>
                Policing the room was the IT technician, a small middle-aged man who had been selected for the role due
                to his aspirations of one day becoming an evil dictator. I assume. Policing is probably too weak a word
                – this guy loved his job. He was tasked with keeping order in the room, ensuring that nobody was using a
                college computer for anything untoward.
            </p>

            <p>
                To this day, my intuition tells me that his bonus must have been dependent on how many people he managed
                to kick off a machine and escort out of the room, and that it’s doubtful he didn’t pay off his mortgage
                early.
            </p>

            <p>
                He sat in the far corner of the computer hall behind a corner desk, where one could fairly conclude that
                his fertile monitors had found a way to reproduce with an impressively short gestation period. It was
                anyone’s guess whether he was actually behind them. Of course, I’m kidding… did I mention that he took
                his job very seriously?
            </p>

            <p>
                The network of machines ran Windows 2000 at the time. I soon discovered that every login process ran a
                script that started a VNC server process using a privileged account. Whenever the IT technician made you
                his next target, he’d connect directly to your machine and watch you. It was creepy, and thinking about
                it now, most likely illegal.
            </p>

            <p>
                Having cut my teeth with <a href="/give-yourself-more-playtime/">BASIC on the C64</a>, I was now writing
                C and even a bit of C++. At the time, I was also really into D, believing it to be a nice overhaul of
                some of the things I didn’t like about C++.
            </p>

            <p>
                Most of my visits to the computer hall were to read more about D, or play with the Digital Mars D
                compiler. When I wasn’t convincing myself that D was the future, I would write C code to hack other
                Win32 programs via their window handles.
            </p>

            <p>
                Back in the good old days of Win32 programming, finding a window handle was the easy method to start
                hacking other programs. Unsurprisingly, all visual programs in Windows had a window, even if you
                couldn’t see it. By writing a program that acquired the window handle (essentially a reference) of
                another process, you could send it messages. That allowed you to do basic things like hide/show the
                program’s window(s), or do really cool things like cause the process to load a custom DLL into its
                memory space and begin executing code. You could really start to have some fun once you got into DLL
                injection territory.
            </p>

            <p>
                During the first 6 weeks of college, Detective Technician didn’t bother me much, connecting briefly to
                my machine’s VNC server only once or twice. However, one particular session must have piqued his
                interest. I was writing some C code to hide instances of Minesweeper (without closing them) so I could
                play it more easily in class, when I noticed the white VNC icon in my system tray turn black, meaning he
                was now watching me.
            </p>

            <p>
                I continued coding as normal, trying to ignore him. Meanwhile, my machine was now grinding to a halt as
                it attempted to stream the very best frame rate it could over to one of the ridiculous number of
                monitors in the corner of the room. It wasn’t long before it had become only slightly more resposive
                than a brick, so I logged off and called it a day.
            </p>

            <p>
                Over the next few visits to the computer hall, Columbo took a very keen interest in what I was doing
                almost every time. After about the 4th time, I decided I needed to do something about it.
            </p>

            <p>
                A sensible, rational person may have simply raised the issue with him or his boss directly, I admit
                that. I, however, have always been tempted by the challenge, and quickly talked myself into an
                altogether different strategy to solve the problem.
            </p>

            <p>
                “You’re nothing without that VNC server!” I told myself <strike>calmly</strike> emphatically
                <strike>once</strike> more than once.
            </p>

            <p>
                I needed to kill VNC.
            </p>

            <p>
                I started entering the computer hall with larger groups of people and sitting as far away from monitor
                corner as possible. That worked for a while, and bought me some time to explore ideas.
            </p>

            <p>
                My first attempt, I think you’ll agree, was rather weak. Right-clicking the VNC system tray icon, I was
                met with a menu containing those magic letters E-x-i-t. Unfortunately they were written in grey outlined
                text. They had used the Group Policy Editor to disable the ‘Exit’ menu item, which I had seen done
                before. I also tried to kill the process from Task Manager, but of course it was invisible to me as it
                was running under another, more privileged account. No dice.
            </p>

            <p>
                VNC server runs on TCP port 5900, I remembered. My next plan was to send it intentionally malformed
                packets to make it crash.
            </p>

            <p>
                That kept me busy for at least a few days while I tried to work out the protocol and sent it various
                forms of legitimately structured crap, hoping it would implode. In the end, that also didn’t work. No
                dice again.
            </p>

            <p>
                I was coming to the conclusion that I may not be able to get rid of this thing when it hit me.
            </p>

            <p>
                “It must have a window! Maybe if I show it, it’ll have a nice juicy ‘Shut Down’ button I can make very
                good use of.”
            </p>

            <p>
                Yielding my already perfected C code to locate a another process’s main window handle, I indeed managed
                to find VNC’s. It really felt like I was about to strike oil when I dispatched a
                <code>WM_SHOWWINDOW</code> message. Before I tell you, try to guess what appeared before me?
            </p>

            <p>
                Nothing!
            </p>

            <p>
                Now I was curious… it had a window alright, but it was ignoring the messages I was sending. I
                double-checked my code to make sure it worked. I tested it on a few other processes and it worked just
                fine. I tried sending VNC’s window other kinds of messages, and still nothing.
            </p>

            <p>
                And that’s when it dawned on me!
            </p>

            <p>
                Thanks to Charles Petzold’s very heavy <a href="http://amzn.com/157231995X">book</a>, I’d become an avid
                student of how Win32 processes worked internally. Every Win32 application has a window, and as part of
                that it also has a ‘message queue’. Messages caused by user interactions, and those sent by Windows
                itself are received on the message queue, and it’s the responsibility of the application itself to deal
                with those messages.
            </p>

            <p>
                Not too interesting by itself, but when I realised that a large enough unprocessed message queue is a
                heuristic for a hung process intervention by the Window Process Manager, I was sweating pure serotonin.
            </p>

            <p>
                Without a second to spare, I was back in front of my C code getting it ready to send VNC’s main window
                another <code>WM_SHOWWINDOW</code> message. In a loop. Forever. So, lots and lots of
                <code>WM_SHOWWINDOW</code> messages, which I now knew it intended to completely ignore… to its peril.
            </p>

            <p>
                I compiled and ran 4KB of some of most liberating code I’d ever written. About 3 seconds later Windows
                informed me that <code>vncserver.exe</code> was not responding, making me an offer I just can’t refuse.
            </p>

            <p>
            <blockquote>Do you want to end this process?</blockquote>
            </p>

            <p>
                Fuck yes!
            </p>

            <p>
                Let me tell you, the rest of that afternoon I was unbearably pleased with myself.
            </p>

            <p>
                After a few hours spent digesting my new superpower, I had decided how I was going to use it. Simply
                killing his session in front of his very eyes would be too easy. I had a better idea – I’d disappear
                altogether.
            </p>

            <p>
                After my <a href="/zzuy-a-lesson-in-perseverance/">baptism of fire with socket programming</a>, I
                realised I could write some code that would do two things. First it would bind to the newly freed up TCP
                port 5900, previously occupied by an ignorant VNC server process. Second it would make a new TCP
                connection to a designated machine’s VNC server. If the code simply proxied all data between the two
                sockets, Columbo would think he was connecting to me, when he’d actually be connecting to someone else
                entirely.
            </p>

            <p>
                My code would act as a secret bridge between me and some other poor soul of my choosing. It was perfect.
            </p>

            <p>
                I got started right away writing my fake VNC bridge. Columbo connected to me a few times, but I
                continued coding as he watched. I figured he’d have no idea what I was doing as long as I left out
                obvious things like port numbers, and comments I otherwise might have included, such as
                <code>// Goodbye creepy VNC spy guy</code>.
            </p>

            <p>
                After a couple of days, I was really struggling to get the code to work correctly. Making matters worse,
                I wasn’t getting much time without a black VNC icon in my system tray. While he was connected to me, it
                was impossible to free up the port to test my code.
            </p>

            <p>
                If only I’d known about <code>netcat</code> at this point!
            </p>

            <p>
                In the end, being an impatient 17-year old and seeing another white VNC server icon turn black, I’m
                sorry to say that I threw the plan out of the window. I opened up the code I first wrote to flood VNC’s
                message queue and I ran it while he watched. I even waited a couple of seconds before clicking "End
                Process", just to make sure he saw it.
            </p>

            <p>
                If clicking that button didn’t fully convince me it was worth it, seeing him emerge from behind his
                monitor fortress to fast-walk his way over to me and escort me out of the room definitely did.
            </p>

            <p>
                In the end, they banned me from the network for 2 weeks. A fair punishment, I thought. About 3 weeks
                later, VNC server was no longer being run during login scripts and was nowhere to be found. I never
                found out whether my incident played any part in that or not, but it totally ruined my plan to become
                filthy rich by selling my VNC cannon to oppressed college computer halls across the country.
            </p>

            <p>
                If you enjoyed this, you may also enjoy some of my other coding stories:
            </p>

            <ul>
                <li>
                    <a href="/zzuy-a-lesson-in-perseverance/">ZZüy – A Lesson In Perseverance</a>
                </li>

                <li>
                    <a href="/give-yourself-more-playtime/">Give Yourself More Playtime</a>
                </li>
            </ul>
        </article>
    </div>
</body>

</html>